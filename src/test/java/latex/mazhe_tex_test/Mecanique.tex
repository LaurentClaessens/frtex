\section{Some symplectic and Poisson geometry}\label{sec:symple}
%--------------------------------------------

\subsection{Symplectic manifold}
%-------------------------------

A \defe{symplectic structure}{symplectic!vector space} on a vector space $V$ is a skew-symmetric, nondegenerate bilinear $2$-form $\dpt{\Omega}{V\times V}{\eR}$. We define the \defe{symplectic group}{symplectic!group} $\SP(\Omega)$\nomenclature{$\SP(V,\Omega)$}{Symplectic group} as the group of linear operators $\dpt{A}{V}{V}$ such that $\Omega(Au,Av)=\Omega(u,v)$ for every $u$, $v\in V$. It is easy to see that elements of $\SP(V)$ satisfy
\begin{equation} \label{EqPropodefMtrsym}
   A^t\Omega A=\Omega.
\end{equation}
The Lie algebra of $\SP(\Omega)$ is denoted by $\gsp(\Omega)$\nomenclature{$\mfsp$}{Symplectic algebra}. Taking the derivative of equation \eqref{EqPropodefMtrsym} with respect to $A$, one finds the following condition for $B\in\gsp(\Omega)$:
\begin{equation}
 \Omega B+B^{t}\Omega=0.
\end{equation}

If $W$ is a subspace of the symplectic vector space $V$, the \defe{symplectic complement}{symplectic!complement} is
\begin{equation}
   W^{\omega}=\{ x\in V\tq \omega(x,y)=0\;\forall y\in W \}.
\end{equation}
 We say that $W$ is a \defe{Lagrangian}{Lagrangian!subspace} of $V$ when $W=W^{\omega}$. Typically, when one consider the canonical structure $\Omega(p_{i},q_{j})=\delta_{ij}$ on $\eR^{2n}$, the spaces $\Span\{ p_{i}\tq i=1,\ldots, n \}$ and $\Span\{ q_{i}\tq i=1,\cdots,n \}$ are Lagrangian.

A \defe{symplectic manifold}{symplectic!manifold} is the data of a smooth manifold $M$ and a symplectic structure $\omega_{x}$ on each tangent space $T_{x}M$. The map $x\mapsto \omega_{x}$ is required to be a smooth section of the $2$-tensor bundle.

\begin{definition} 
A \defe{symplectic Lie algebra}{symplectic!Lie algebra} is a Lie algebra $\mfs$ endowed with a symplectic structure $\omega$  such that $\forall x$, $y$, $z\in\mfs$,
\begin{equation}   \label{EqDefAlgSymple}
\omega([x,y],z)+\omega([y,z],x)+\omega([z,x],y)=0.
\end{equation}
\label{DefSympleAlg}
\end{definition}
\subsection{Poisson manifold}
%-----------------------------

Let $M$ be a smooth manifold. A \defe{Poisson structure}{Poisson structure}, or a \emph{Poisson bracket} on $M$ is a map $\{ .,. \}\colon  C^{\infty}(M)\times C^{\infty}(M)\to  C^{\infty}(M)$ such that
\begin{enumerate}
\item $\big(  C^{\infty}(M), \{ .,. \} \big)$ is a Lie algebra,
\item for each $f\in C^{\infty}(M)$, the map $\{ f,. \}$ is a derivation of the algebra $ C^{\infty}(M)$:
\[ 
  \{ f,gh \}=\{ f,g \}h+g\{ f,h \}.
\]
\end{enumerate}

\subsection{Hamiltonian action}\label{app:ham_act}
%///////////////////////////////////

Let $(M_1,\omega_1)$ and $(M_2,\omega_2)$ be symplectic manifolds. A \defe{symplectomorphism}{symplectomorphism} from $M_1$ to $M_2$ is a diffeomorphism $\varphi\colon M_1\to M_2$ such that $\varphi^*\omega_2=\omega_1$.

For any function $f\in C^{\infty}(M)$, we define the \defe{Hamiltonian field}{Hamiltonian!field} $X_f\in\cvec(M)$ associated with $f$ by
\begin{equation}   \label{EqDefHamVect}
  i(X_f)\omega=df.
\end{equation}
 Existence of such a $X_f$ for each $f$ is assured because $\omega$ is nondegenerate.  A symplectic structure induces a Poisson bracket by defining\index{Poisson structure!on symplectic manifold}
\begin{equation}\label{eq:def_Poisson}
   \{f,g\}=-\omega(X_f,X_g)=-X_g(f)=X_f(g).
\end{equation}
In local coordinates, one can write $\omega=\frac{1}{2}\omega_{ij}dx^i\wedge dx^j$ and $X_f=\omega^{ij}\partial_if\partial_j$, where $(\omega^{ij})$ is the inverse matrix of $(\omega_{ij})$. The Poisson tensor defined by
\begin{equation}  \label{EqPoisson} 
   \{f,g\}=P^{kl}\partial_kf\partial_lg,
\end{equation} 
is nothing else than $P=\omega^{-1}$.

\begin{theorem}\label{tho:equiv_Poisson}
If $\varphi\colon M\to M'$ is a diffeomorphism between two Poisson manifolds $(M,P)$ and $(M',P')$, then the following are equivalent:
\begin{enumerate}
\item $\varphi_*(X_{f\circ\varphi})=X'_f$,
\item\label{ite_equivii} $\{u\circ\varphi,v\circ\varphi\}=\{u,v\}'\circ\varphi$,
\item $\varphi_*P=P'$,
\end{enumerate}
If moreover the Poisson structures $P$ and $P'$ come from symplectic forms $\omega$ and $\omega'$, $\varphi^*\omega'=\omega$.
\end{theorem}

\begin{definition}
Let $\dpt{\tau}{G\times M}{M}$ be a symplectic action of a Lie group $G$ on $M$ (i.e. $\dpt{\tau_g}{M}{M}$ is a symplectic transformation of $M$ for each $g\in G$). That action is \defe{Hamiltonian}{Hamiltonian!action} if, for every $X\in\mG$, there exists a map $\lambda_X\in C^{\infty}(M,\eC)$ such that
\begin{subequations}\label{eq:act_ham}
\begin{align} 
  i(X^*)\omega&=d\lambda_X,\label{1s17d}\\
  \{\lambda_X,\lambda_Y\}&=\lambda_{[X,Y]}\label{eq:hamil}
 \end{align}
\end{subequations}
where $X^*$ is the fundamental vector field associated with the vector $X$.
\end{definition}

\begin{definition}
The map $\dpt{\lambda}{\mG}{\Cinf(M)}$ which satisfies \eqref{eq:act_ham} is the \defe{dual}{momentum map!dual} momentum map while the \defe{momentum map}{momentum map} is $\dpt{J}{M}{\mG^*}$ defined by
   \begin{equation} \label{eq:defmomm ap}
     \lambda_X(x)=\langle J(x),X\rangle
   \end{equation}
for all $X\in\mG$.
\label{def:app_mom_mom_duale}
\end{definition}
Using the musical isomorphism (see \ref{subsec_musique}), equation \eqref{1s17d} can be written as $(d\lambda_X)^{\sharp}=X^*$ or $d\lambda_X=(X^*)^{\flat}$.

Since $i(X_{\lambda_Y})\omega=d\lambda_Y=i(Y^*)\omega$, we have:
\begin{equation} \label{eq_XlambdaYs}
   X_{\lambda_Y}=Y^*.
\end{equation} 
The \defe{symplectic gradient}{symplectic!gradient} is
\[
  \sgrad u=(du)^{\sharp}.
\]

 \begin{remark}
 If the action only fulfils \eqref{1s17d}, it is said to be \defe{weakly Hamiltonian}{Hamiltonian!action!weak}. But one can find some literature in which the first condition is called a \emph{Hamiltonian action} and the second, a \emph{strongly Hamiltonian} one.
 \end{remark}
 
\begin{remark}
Be careful with some choices of signs. We made at least three choices: the definition of $\lambda_X$ in \eqref{1s17d} can get a minus sign; the definition of the Poisson bracket \eqref{eq:def_Poisson} is modulo a sign; and the definition of the fundamental fields that we take is
 \begin{equation}   \label{EqDefFondsiTHZ}
  X^*_{x}=\Dsdd{ \tau_{ e^{-tX}}x }{t}{0}.
\end{equation} 
 It can be written without the minus sign in the exponential. Each of these choice is free, by condition \eqref{eq:hamil} is not ! If one make  ``wrong'' choices, this can become
\begin{equation}
   \{\lambda_X,\lambda_Y\}=-\lambda_{[X,Y]},
\end{equation}
with all the consequences in the computations. For example, if one defines $X^*_x=\dsdd{\tau_{\exp tX}x}{t}{0}$, one finds an extra minus sign in equations \eqref{EqlamHal}, \eqref{EqlamEal} and \eqref{EqlamFal}.
\end{remark}

\subsection{Coadjoint orbits}		\label{sub:coadjoint}
%///////////////////////////////

Let $G$ be a Lie group and $\mG$ its Lie algebra.  We know that $G$ acts on the dual $\mG^*$ by
\begin{equation}    \label{EqDefActCoadj}
  g\cdot \xi=\xi\circ \Ad(g^{-1})=\Ad(g)^*\xi
\end{equation}
for $g\in G$ and $\xi\in\mG^*$. The second equality defines the \defe{coadjoint action}{coadjoint!action} $\Ad^*\colon G\times\mG^*\to \mG^*$. In other words, for all $X\in\mG$,
\[
(g\cdot \xi)(X)=\langle \xi,\Ad(g^{-1})X\rangle=\langle \Ad(g)^*(\xi),X\rangle.
\]
This representation is also called the \defe{\wikipedia{en}{Dual_representation}{contragredient} representation}{contragredient representation}.
In this context, the notion of fundamental fields is given bu $X^*_{\xi}=\xi\circ\ad(X)$. Let $\theta_{\xi}=\{g\cdot \xi|g\in G\}$, the orbit of $\xi$ in $\mG^*$. It can be shown that 
\begin{equation}\label{eq_omega_Gs}
  \tilde\omega_x(X^*_x,Y^*_x)=\langle x,[X,Y]\rangle
\end{equation}
 defines a symplectic form on $\theta_{\xi}$\nomenclature{$\theta_{\xi}$}{Coadjoint orbit of $\xi$}, the coadjoint orbit of $\xi$.

\begin{proposition}
The coadjoint action is Hamiltonian.
\end{proposition}

\begin{proposition}
The diffeomorphism 
\begin{equation}
\begin{aligned}
 \varphi(g)\colon \theta_{\xi}&\to \theta_{\xi} \\ 
  \xi&\mapsto g\cdot \xi 
\end{aligned}
\end{equation}
fulfils 
\[
   \big(\varphi(g)^*\omega\big)_{\xi}(X^*_{\xi},Y^*_{\xi})=\omega_{\xi}(X^*_{\xi},Y^*_{\xi}).
\]
\end{proposition}

%---------------------------------------------------------------------------------------------------------------------------
\subsection{Example of adjoint and coadjoint orbit}
%---------------------------------------------------------------------------------------------------------------------------

Let us consider the following subgroup of $\SL(2,\eR)$
\begin{equation}
	\eS=\{ \begin{pmatrix}
		a	&	n	\\ 
		0	&	a^{-1}	
	\end{pmatrix}\text{where $a>0$ and $n\in\eR$}\}.
\end{equation}
The Lie algebra is
\begin{equation}
	\lS=\{ \begin{pmatrix}
		x	&	y	\\ 
		0	&	-x	
	\end{pmatrix}\text{where $x,y\in\eR$}\}.
\end{equation}
The following is a basis of $\lS$:
\begin{equation}
	\begin{aligned}[]
		H=\begin{pmatrix}
			1	&	0	\\ 
			0	&	-1	
		\end{pmatrix}&&E&=\begin{pmatrix}
			0	&	1	\\ 
			0	&	0	
		\end{pmatrix}
	\end{aligned}
\end{equation}
and the commutation relation is $[H,E]=2E$. Since we are in a matrix group, the adjoint action is given by $\Ad(g)X=gXg^{-1}$ and we can compute
\begin{equation}
	\Ad(a,n)(x,y)=\begin{pmatrix}
		x	&	ay^2-2nax	\\ 
		0	&	-x	
	\end{pmatrix}
	=
	xH+(a^2y-2nax)E
\end{equation}
Thus the adjoint orbits are the straight lines.

For the coadjoint orbits, consider an element $\xi=\xi_HH^*+\xi_EE^*\in\lS^*$. We have
\begin{equation}
	\begin{aligned}[]
		\langle \Ad^*(g^{-1})\xi, X_0\rangle &=\langle \xi, \Ad(g)X\rangle \\
			&=(\xi_H-2na\xi_E)x+a^2\xi_Ey.
	\end{aligned}
\end{equation}
If we write $\xi=(\xi_H,\xi_E)$ we have
\begin{equation}
	\Ad^*(a,n)^{-1}(\xi_H,\xi_E)=\begin{pmatrix}
		1	&	-2na	\\ 
		0	&	a^2	
	\end{pmatrix}\begin{pmatrix}
		\xi_H	\\ 
		\xi_E	
	\end{pmatrix}.
\end{equation}
This is the orbit of $\xi$. Notice that $H^*$ is fix while $E^*\mapsto -2na H^*+a^2E^*$, so that $E^*$ has a quite large orbit. If $\xi_2\neq 0$, then $\dim\Ad^*(\eS)\xi=2$. If $\xi_E=0$, then the orbit is one single point. Thus we have three kind orbits in the plane $(H^*,E^*)$:
\begin{enumerate}

	\item
		the upper half plane is one two dimensional orbit,
	\item
		each of the point on the $\xi_E=0$ is an orbit,
	\item
		the lower half plane is a second two dimensional orbit.
\end{enumerate}
These orbits are very different from the adjoint orbits.

%---------------------------------------------------------------------------------------------------------------------------
\subsection{A second example}
%---------------------------------------------------------------------------------------------------------------------------

Let $\lG=\SL(2,\eR)$ and the basis $\{ H,E,F \}$ with the relations
\begin{equation}
	\begin{aligned}[]
		[H,E]&=2E\\
		[H,F]&=-2F\\
		[E,F]&=H.
	\end{aligned}
\end{equation}
The Killing form is given by the matrix
\begin{equation}
	\beta=\begin{pmatrix}
		8	&	0	&	0	\\
		0	&	0	&	4	\\
		0	&	4	&	0
	\end{pmatrix}.
\end{equation}
It is nondegenerate and its signature is $+,+,-$.

\begin{lemma}
	If the Killing form $\beta$ is nondegenerate, the map
	\begin{equation}
		\begin{aligned}
			\flat\colon \lG&\to \lG^* \\
			X^{\flat}(y)&=\beta(X,Y) 
		\end{aligned}
	\end{equation}
	is a linear $\Ad$-equivariant\index{equivariant} isomorphism, that is
	\begin{equation}
		\Ad^*(g)(X^{\flat})=\big( \Ad(g)X \big)^{\flat}.
	\end{equation}
\end{lemma}

\begin{proof}
	We have
	\begin{equation}
		\begin{aligned}[]
			\langle \Ad^*(g)X^{\flat}, Y\rangle &=\beta\big( X,\Ad(g^{-1})Y \big)\\
				&=\beta\big( \Ad(g)X,Y \big)\\
				&=\big( \Ad(g)X \big)^{\flat}Y.
		\end{aligned}
	\end{equation}
\end{proof}
In that case, the $\flat$ map intertwines the actions and the adjoint orbits are the same as the coadjoint orbits.


\subsection{Kostant theorem} 
%--------------------------

Let $G$ act transitively on $M$ and on $\mG^*$ by the coadjoint action \eqref{EqDefActCoadj}. We suppose this action to be Hamiltonian. One can prove that $J$ is \defe{equivariant}{equivariant!momentum map}:
\begin{equation}
  J(g\cdot x)=g\cdot J(x)
\end{equation}
where the first dot is the action on $M$ and the second one, the action on $\mG^*$. The momentum map of $M$ and $\mG^*$ are related by $\lambda_X^M=\lambda_X^{\mG^*}\circ J$. Since $G$ is transitive on $M$, for any $x\in M$, we have $M=G\cdot x$ for any $x$ in $M$, so
\[ 
  J(M)=G\cdot J(x).
\]
We conclude that $J(M)$ is only one orbit in $\mG^*$. 

\begin{proposition}
	Let $\mO$ be the coadjoint orbit of a connected Lie group $G$. Then $\mO$ is canonically endowed by a $\Ad^*(G)$-equivariant symplectic structure given by
	\begin{equation}		\label{EqKKSsymple}
		\omega^{\mO}_{\xi}(X^*,Y^*)=\langle \xi, [x,Y]\rangle 
	\end{equation}
	where $X^*$ stands for the fundamental vector. Here the equivariance means
	\begin{equation}
		\Ad^*(g)\omega^{\mO}=\omega^{\mO}
	\end{equation}
	for every $g\in G$.
\end{proposition}

\begin{proof}
	No proof.
\end{proof}
The formula \eqref{EqKKSsymple} is \emph{Kirillov-Kostant-Souriau}. Notice that this proposition shows that the coadjoint orbits are always even dimensional.


If $\xi\in\mG^*$, we know a symplectic structure on its orbit $\theta_{\xi}$:
\begin{equation}
   \omega_{\eta}^{\theta}(X^*_{\eta},Y^*_{\eta})=\eta([X,Y])
\end{equation}
for all $\eta\in\theta_{\xi}$. We have
\begin{equation}
\begin{split}
  (J^*\omega^{\theta})_x(X^{*M},Y^{*M})&=\omega_{J(x)}^{\theta}(X^*,Y^*)\\
		&=J(x)[X,Y]\\
		&=\lambda^M_{[X,Y]}(x)\\
		&=\{ \lambda_X^M,\lambda_Y^M \}(x),
\end{split}
\end{equation}
and if $M$ is symplectic, it also fulfils $\omega_x^M(X^{*M},Y^{*M})=\{ \lambda_X^M,\lambda_Y^M \}(x)$, so that 
\begin{equation}
  J^*\omega^{\theta}=\omega^M.
\end{equation}

\begin{theorem}[Kostant theorem]
Let $(M,\omega)$ be a symplectic manifold on which the connected Lie group $G$ has a transitive Hamiltonian action. Then the momentum map $\dpt{J}{M}{\mG^*}$ takes his values in only one orbit $\theta$ and $J$ is a covering\quext{revêtement, en français.} of $G$ in $\mG^*$.
\end{theorem}

\begin{proof}
Let us fix a $x\in M$, we pose $\xi=J(x)$ and define $G_x$, the stabilizer of $x$ in $G$.  Formula $\psi(g)=g\cdot x$ defines a bijection $\psi\colon G/G_{x}\to M$.  So we identify $M=G/G_x$. In the same way, $\theta_{\xi}=G/G_{\xi}$. So we can write $J(x)=G_{\xi}$ and
\[ 
   J(g\cdot G_x)=g\cdot J(x)=g\cdot G_{\xi}.  
\]
Since $g\cdot \xi=g\cdot J(x)=J(g\cdot x)=J(x)=\xi$, we have $G_x\subset G_{\xi}$. The nondegenerateness of $\omega^M$ and $\omega^{\theta}$ makes $J$ nondegenerate because $\omega^M=J^*\omega^{\theta}$. Then $dJ$ is injective and $J$ is an immersion.

We conclude that $\mG_x=\mG_{\xi}$ which proves that $G_{\xi}/G_x$ is discrete and finally that $J$ is a covering.

\end{proof}
\subsection{Central extension}
%--------------------------

Let $\mG$ be a Lie algebra. A \defe{Chevalley coboundary}{chevalley!coboundary} is a $2$-form which reads $\delta\xi$ for a certain $\xi\in\mG^*$ with $\delta$ defined by
\begin{equation}  \label{EqDefChevCoycl}
   (\delta\xi)(A,B)=-\xi([A,B]).  
\end{equation}
Let $\Omega$ be a $2$-cocycle. If it is not a coboundary, we add an element $C$ in $\mG$ and we consider $\mG'=\mG\oplus\eR C$ with the Lie algebra structure
\begin{equation}
  [A+s,B+t]_{\mG'}=[A,B]_{\mG}+\Omega(A,B)C.
\end{equation}
This is the \defe{central extension}{central!extension} of $\mG$ with respect to the $2$-cocycle $\Omega$. The terminology comes from the fact that the extension $\eR C$ belongs to the center of $\mG'$. The point is that $\Omega$ is a coboundary in $\mG'$ because 
\begin{equation}
\begin{split}
(\delta C^*)(A,B)=C^*[A,B]_{\mG'}
		=C^*\big( [A,B]_{\mG}+\Omega(A,B)C \big)
		=\Omega(A,B),
\end{split}
\end{equation}
so that $\Omega=\delta C^*$.

Now we suppose that the group $G$ acts on a manifold $M$. We define the action of the extended group $G'=G\otimes e^{\eR C}$ by saying that the ``new'' part does not act: $(g,s)\cdot x=g\cdot x$. Fundamental fields remains unchanged:
\begin{equation}  \label{eq:XseqXss}
(X,s)^*=X^*.
\end{equation}
 If the action of $G$ on $M$ is weakly Hamiltonian, we have functions $\dpt{ \mu_x}{M}{\eC}$ such that $i(X^*)\omega=d\mu_X$. These functions fulfil $X^*=\{ \mu_X,\,. \}$. We define 
\begin{equation} \label{eq:lamXsmuXs}
  \lambda_{X,s}=\mu_X+s.
\end{equation}

\begin{proposition}
The action of $G'$ is (strongly) Hamiltonian for these functions. 
\end{proposition}

\begin{proof}

From equation \eqref{eq:XseqXss}, we have $\{ \mu_X,. \}=\{ \mu_{X,s},. \}$ hence
 \begin{equation}
  \{ \lambda_{(X,s)},\lambda_{(Y,t)} \}=\{ \mu_X,\mu_Y \}
		=\mu_{[X,Y]}+C_{X,Y}
\end{equation}
for certain constants $C_{XY}$ which satisfy the property $d\big( \{ \mu_X,\mu_Y \}-\mu_{[X,Y]} \big)=0$.
Therefore
\begin{equation}
  \{ \lambda_{(X,s)},\lambda_{(Y,t)} \}=\lambda_{[X,Y],C_{X,Y}}
			=\lambda_{[(X,s),(Y,t)]}.
\end{equation}

\end{proof}

The sense of the whole construction is the following. When the action $G$ is weakly Hamiltonian on $M$, we have functions $\mu_X$ which define $\Omega$ by
\[ 
  \{ \mu_X,\mu_Y \}=\mu_{[X,Y]}+\Omega(X,Y).
\]
In this case, the corresponding group extension has a strongly Hamiltonian action with momentum maps given by \eqref{eq:lamXsmuXs}. 

%+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
\section{Constrained system}

%----------------------------------------------------------------------------------------------------------------------------
\subsection{Holonomic constraints}

References are \cite{ms_book,Schomblond_Hamcontra}. An \defe{holonomic constraint}{holonomic constraint} appears when one force a particle to move for an example on a circle. More formally let $Q$ be the configuration space; an holonomic constraint is a submanifold $N\subset Q$, or more generally an integrable subbundle of $TQ$. From the inclusion $TN\subset TN$, the Lagrangian restricts to $L_N\colon TN\to \eR$.

We assume that $L_N$ is a regular Lagrangian (see definition on page \pageref{PgDefRegular}) and that $N$ is given by an equation of the form $N=\varphi^{-1}(0)$ for a certain section $\varphi\colon Q\to E^*$ of the dual of a vector bundle over $Q$. The variational principle is given by
\begin{equation}
	\delta\int L_N(q,\dot q)dt=0
\end{equation}
where the function $q$ is constrained by $\varphi\big( q(t) \big)=0$ for every $t$. We enforce that condition by the Lagrange multiplier method:
\begin{equation}
\delta\int\Big(    L\big( q(t),\dot q(t) \big)-\big\langle \lambda\big( q(t),t \big), \varphi\big(q(t))\big\rangle      \Big)dt
\end{equation}
where $\lambda$ is a function of $(q,t)$ with values in $E$. The $\delta$ denotes a variation on the curves $q$ in $Q$ and $\lambda$ in $E$. In local coordinates, the Euler-Lagrange equations read
\begin{align}
  \frac{ d }{ dt }\left(    \frac{ \partial L }{ \partial \dot q^i }  \right)&=\frac{ \partial L }{ \partial q^i }-\lambda\frac{ \partial \varphi_a }{ \partial q^i },& \varphi_a=0.
\end{align}
So the Euler-Lagrange equations for $L_N$ on $N$ are the sames as the one of $L$ on $Q$, with the constraint $\varphi=0$.

%----------------------------------------------------------------------------------------------------------------------------
\subsection{Primary constraints}

The action is given by 
\[ 
  S(q)=\int_{t_1}^{t_2}L(q,\dot q)dt,
\]
and we require the action to be stationary with respect to variations $\delta q$ vanishing on $t_1$ and $t_2$. The Euler-Lagrange equations are given by $\frac{ \delta S }{ \delta q }=\frac{ \partial L }{ \partial q }-\frac{ d }{ dt }\left( \frac{ \partial L }{ \partial \dot q } \right)=0$ or, in coordinates,
\[ 
  0=\frac{ \partial L }{ \partial q^k }-\dot q^l\frac{ \partial L }{ \partial q^l\partial q^k }-\ddot q^l\frac{ \partial L }{ \partial \dot q^l\partial \dot q^k }.
\]
when the Hessian matrix is invertible, i.e. when
\[ 
  \det\left( \frac{ \partial L }{ \partial \dot q^l\partial \dot q^k } \right)\neq 0,
\]
one can solve these equations in an algebraic way for the accelerations $\ddot q$ in functions of the positions $q$ and the velocities $\dot q$. When that determinant is vanishing, some of the Euler-Lagrange equations are simple relations between components of $q$ and components of $\dot q$, so that the solutions include some arbitrary functions of time.

\subsubsection{Example: Maxwell}
%///////////////////////////////

The action is 
\[ 
  S(A)=-\frac{ 1 }{ 4 }\int F_{\mu\nu}F^{\mu\nu}d^4x
\]
with $F_{\mu\nu}=\partial_{\mu}A_{\nu}-\partial_{\nu}A_{\mu}$. That actions has a gauge invariance
\[ 
  A_{\mu}\mapsto A'_{\mu}=A_{\mu}+\partial_{\mu}f
\]
for any function $f$. The equations of motion are $\partial_{\nu}F^{\mu\nu}=0$, in particular the equation $\nabla\times{\bB}=\partial_t{\bE}=0$ provides the $\ddot A_k$ in terms of the $A_l$ and $\dot A_{\mu}$. Indeed the Hessian
\[ 
  \frac{ \partial^2L}{ \partial \dot A_{\alpha}\partial\dot A_{\beta} }=-4\big( g^{0\beta}g^{\alpha 0}+g^{\alpha\beta} \big)=
\begin{pmatrix}
0\\&1\\&&1\\&&&1
\end{pmatrix},
\]
has vanishing determinant.

%----------------------------------------------------------------------------------------------------------------------------
\subsection{Passage to Hamiltonian formalism}

The very principle is to define the momentums $p_k=\frac{ \partial L }{ \partial \dot q^k }$, so that
\[ 
  \frac{ \partial p_k }{ \partial \dot q^l }=\frac{ \partial^2L }{ \partial \dot q^l\partial \dot q^k }, 
\]
so that the vanishing determinant condition makes that it is not possible to solve the velocities $\dot q^k=\dot q^k(q,p)$. That means that the momentums are not independent: there exists relations
\begin{equation}
\phi_m(p,q)=0
\end{equation}
for $m=1,\ldots,M$. These relations are the \defe{primary constraints}{primary constraints}: they do not rely on the equations of motion. In other terms, we have
\[ 
  \phi_m\big( q,p(q,\dot q) \big)=0
\]
identically, and not only on the solutions.

In the Maxwell example, we pose the momentums $\pi^{\alpha}=\frac{ \partial L }{ \partial \dot A_{\alpha} }=F^{0\alpha}$. Notice that $\pi^0+F^{00}=0$ and that the remaining is $\pi^k=E^k$ (the electric field).

If one suppose the rank of the Hessian to be constant, the constraints $\phi_m(q,p)=0$ define a submanifold of the phase space. This is the \emph{primary constraint surface}.

Suppose that the primary constraints can be divided into one set of independent constraints $\phi_m$, $m=1,\ldots,M'$ with the rank of $\frac{ \partial \phi_{m'} }{ \partial X }$ being $M'$ ($X=(q,p)$) and some dependent constraints $\phi_{\bar m}$ such that vanishing of all the $\phi_{m'}$ implies the vanishing of all the $\phi_{\bar m}$.

In that case, we have two important results.
\begin{theorem}
If a function $G$ vanishes on the constraint surface $\phi_m=0$, then there exists functions $g^m$ such that $G=g^m\phi_m$.
\end{theorem}

\begin{theorem}
If $\lambda^k\delta q^k+\mu^k\delta p_k=0$ for every variations $\delta q^k$ and $\delta p_k$ tangent to the constraint surface, then
\begin{align}
\lambda_k&=u^m\frac{ \partial \phi_m }{ \partial q^k }\\
 \mu^k&=u^m\frac{ \partial \phi_m }{ \partial p_k }
\end{align}
for some functions $u^m$.
\end{theorem}
The tangent assumption means that 
\[ 
  \delta\phi_m=\frac{ \partial \phi_m }{ \partial q^k }\delta q^k+\frac{ \partial \phi_m }{ \partial p_k }\delta p_k=0.
\]
Now the Hamilton equations with $\phi_m=0$ are provided by the action
\begin{equation}		\label{EaHamSqpuint}
S(q,p,u)=\int_{t_1}^{t_2}\big( p_k\dot q^k-H-u^m\phi_m \big)dt
\end{equation}
where the functions $u^m$ are Lagrange multipliers. The equations of motion for $p$ and $u$ provide expressions $p_k=P_k(q,\dot q)$ and $u^m=U^m(q,\dot q)$ in a purely algebraic way, so that one has a reduced action
\[ 
  S_L(q)=S(q,P,U)
\]
which satisfies
\[ 
  \frac{ \delta S_L }{ \delta q^k }=\frac{ \delta S }{ \delta q^k },
\]
so that the variational principle for $q$ are the same with $S_L$ as with the original $S$.

One can show that the equations of motion of the action \eqref{EaHamSqpuint} read
\begin{equation}		\label{EqdotFCrochet}
\dot F=[F,H]+u^m[F,\phi_m]
\end{equation}
for any function $F=F(q,p)$.

%----------------------------------------------------------------------------------------------------------------------------
\subsection{Secondary constraints}

For consistency, one can impose that the constraints are preserved in time: $\dot\phi_m=0$. Using the evolution equation \eqref{EqdotFCrochet} on the function $\phi_m$, one finds, for each $m$, 
\[ 
  \dot\phi_m=[\phi_m,H]+u^n[\phi_m,\phi_n]
\]
which are relations between $q$ and $p$. In the case where that relation is independent of the $\phi_m$, one has a \defe{secondary constraint}{secondary constraint} $X(p,q)=0$ which has to be preserved with the time, so that
\[ 
  [X,H]+u^n[X,\phi_n]=0.
\]
Once again, this is a relation between $p$ and $q$.

